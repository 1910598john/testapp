<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Page Title</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body style="background:#fffbfb;display:grid;place-items:center;padding-top:100px;">
   
<div style="padding:0 20px;display:flex;flex-direction:column;">
    <img src="./img/welcome.gif" style="height:200px;"/>
    Name:
    <input style="border:1px solid #0084ff;padding:5px;border-radius:4px;margin-bottom:5px;outline:none;" id="name"  type="text" placeholder="Enter your name"/>
    User ID: 
    <input style="border:1px solid #0084ff;padding:5px;border-radius:4px;margin-bottom:5px;outline:none;" id="user-id" type="text" placeholder="Enter user ID"/>
    4 digits PIN:
    <input style="border:1px solid #0084ff;padding:5px;border-radius:4px;outline:none;" type="number" id="pin" placeholder="Enter 4 digits pin"/>
    <br>
    <button style="padding: 15px;
    border-radius: 30px;
    background: #0084ff;
    color: #fff;
    border: none;" class="start">START</button>
    <br>
    <p style="text-align: center;font-size:13px;">You agree to our <a style="color:#0084ff;cursor: pointer;">Terms of Use</a></p>
</div>
<script>
var db2;
if (!window.indexedDB) {
    console.log("Your browser doesn't support a stable version of IndexedDB.");
} else {
    // Open (or create) the database
    let request = indexedDB.open("database", 1);
    request.onerror = function(event) {
        console.log("Error opening/creating database:", event);
    };

    request.onsuccess = function(event) {
        console.log("Database opened successfully");
        db = event.target.result;
        db2 = db;
    }
}
$(".start").click(function(event){
    event.stopImmediatePropagation();

    if ($("#name").val() !== '' && $("#user-id").val() !== '' && $("#pin").val() !== '') {
        let transaction = db2.transaction(["user"], "readwrite");
        let objectStore = transaction.objectStore("user");
        let getRequest = objectStore.get(1);
        getRequest.onsuccess = function(event) {
            let data = event.target.result;
            if (!data) {
                let newData = { name: $("#name").val(), user_id : $("#user-id").val(), pin: $("#pin").val() };
                let addRequest = objectStore.add(newData);
                addRequest.onsuccess = function() {
                    window.open("./", '_self');
                    console.log("Started!");
                };
            } else {
                window.open("./", '_self');
            }
        }
    }
    
})
</script>
</body>
</html>
